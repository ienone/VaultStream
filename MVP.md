# MVP 方案：更好的分享系统（BetterShare）

> 目标：用尽可能少的功能，跑通「输入 -> 采集解析 -> 存储 -> 定向分发」的完整闭环，用于验证产品价值与技术架构的可行性，同时保持后续扩展性。

---

## 一、MVP 验证目标

- 验证核心价值：
  - 能否显著降低「收藏/转存优质内容 -> 统一归档 -> 再分发到社交渠道」的摩擦成本？
  - 能否通过简单的标签路由，让不同类型内容自动分流到合适的频道？
- 技术可行性验证：
  - 跨平台内容抓取是否足够稳定（至少 1 个平台）？
  - PostgreSQL + JSONB 的结构化存储是否足够灵活、好查询？
  - 基于机器人（TG/QQ）的分发链路是否顺畅，可实现“推过不再发”？

---

## 二、MVP 范围（Scope In）

### 1. 输入层（Trigger）

- 不追求一开始就完成完整的移动端 App 功能，而是：
  - MVP 期：
    - 提供一个后端 API：`POST /shares`，接受参数：`url`、`tags`、`source`、`is_nsfw`。
    - 提供一个极简 Web 页面（或 Postman / curl 方案）模拟“从手机/浏览器分享链接”行为。
  - 预留扩展：
    - 在文档中固定好移动端未来接入的字段与调用方式，确保将来 Flutter Share Target 可以无缝对接。

### 2. 采集与解析层（Pipeline）

- 实现共用的解析流水线骨架：
  - 统一任务模型（包含 URL、平台类型、状态等）。
  - 使用 Redis 作为任务队列（或简单的数据库任务表 + 轮询）实现异步处理。
- 平台支持（MVP 只选一个优先级最高的平台）：
  - 选择 1 个核心平台作为起点（示例：Bilibili 或 Twitter，根据实现资源决定）。
  - 为该平台实现：
    - URL 净化（去掉追踪参数、短链还原）。
    - 内容基础信息抓取（标题/正文、主要媒体资源、作者信息、原始链接等）。
  - 提供 Adapter 接口抽象，留好未来扩展到：小红书、微博、知乎等。

### 3. 存储层（PostgreSQL + JSONB）

- 数据模型（MVP 级）：
  - `contents` 表：
    - 基础字段：`id`、`platform`、`url`、`status`、`tags`、`is_nsfw`、`created_at` 等。
    - `raw_metadata jsonb`：存储平台特有的元数据（如 B 站播放量、UP 主信息等）。
  - `pushed_records` 表：
    - 字段：`id`、`content_id`、`target_platform`（如 TG_CHANNEL_A）、`pushed_at`。
- 状态机：
  - 明确并实现最小状态流转：`Unprocessed -> Pulled -> Distributed`。
  - `Archived` 状态可先仅在设计层预留，MVP 中简单视为长期保留的数据。

### 4. 分发层（机器人 / Output）

- 选择一个主力分发端作为 MVP：
  - 建议优先：Telegram 机器人（协议开放、部署简单）。
- 分发逻辑（最小闭环）：
  - 机器人能够：
    - 通过命令 `/get [tag]` 从后端拉取一条未推送内容。
    - 按 Tag 路由到不同频道（MVP 时可先只支持一个频道 + 一种 Tag 规则）。
    - 以图文混排形式发送（如：图片 + 标题 + 简介 + 原文链接）。
  - “推过不再发”逻辑：
    - 发送成功后，机器人调用后端接口标记：
      - 在 `pushed_records` 写入记录。
      - 更新 `contents.status` 为 `Distributed`（或维护 `pushed=true` 字段）。
    - 后端查询待推送内容时，排除已在 `pushed_records` 中出现的组合。

### 5. 合规与 NSFW 控制（MVP 级）

- 在数据结构中明确 NSFW 字段：
  - 允许在提交链接时声明 `is_nsfw` 或通过特定标签识别。
- 分发侧：
  - TG 机器人在发送前校验：若内容为 NSFW，仅允许发送到指定 TG 频道。
  - QQ / 其他平台在 MVP 阶段可以直接不接入，后续再扩展。
- Web / RSS 展示在 MVP 阶段可以弱化，仅实现：
  - 简单 RSS 或 JSON 列表接口（供调试使用）。

---

## 三、MVP 明确不做的部分（Scope Out）

- 完整多平台接入（微博、小红书、知乎等）——仅保持 Adapter 接口通用。
- 完整的移动端 Flutter App：
  - 不要求在 MVP 中完成完整 UI/UX 与多页面导航。
  - 不做复杂的历史记录管理、离线缓存、多账号切换等功能。
- 复杂的 Web 前端展示：
  - 不做多主题、复杂筛选、收藏夹、批量操作等高级功能。
- 高级运维与监控：
  - 暂时不引入复杂监控系统，仅保留日志输出和必要的错误告警钩子设计。

---

## 四、MVP 技术选型落地

- 后端：
  - Python + FastAPI（异步化，方便对接爬虫和任务队列）。
  - ORM / Query 层可选：SQLAlchemy (async) 或 Tortoise ORM。
- 数据库：
  - PostgreSQL（启用 JSONB）。
- 缓存与队列：
  - Redis（存放解析任务队列、简单去重 Key）。
- 机器人：
  - Telegram Bot（可后续用 Astrbot/NoneBot2 统一抽象不同协议）。

---

## 五、MVP 交付物与验收标准

### 1. 交付物

- 可运行的后端服务（FastAPI）：
  - 提供 `POST /shares` 接口接收链接。
  - 提供供机器人调用的「获取待分发内容」和「回写推送结果」接口。
- 已配置的 PostgreSQL + Redis 实例（本地或 Docker Compose）。
- 一个可用的平台适配器（如 Bilibili）：
  - 能从 URL 抓取基本信息并落库。
- 一个 Telegram 机器人：
  - 在指定频道内能通过命令拉取并发送内容。

### 2. 验收标准

- 从「提交 URL」到「机器人在频道发出消息」全过程成功率在可控范围内（如 ≥ 90%，错误可通过日志定位）。
- 重复提交同一内容不会导致对同一频道重复推送（验证“推过不再发”逻辑有效）。
- 数据库存储结构能够兼容后续新增平台（通过 JSONB 扩展字段即可，无需大改表结构）。

---

## 六、MVP 完成后的下一步建议

- 扩展第二、第三个平台适配器（例如：Twitter、小红书），验证 Adapter 设计的通用性。
- 引入基础 Web 展示页与检索能力，方便人工浏览和回溯内容。
- 启动 Flutter 移动端 App 的 Share Target 实现，将目前的 Web/API 调试入口替换为真实的「一键分享」体验。
